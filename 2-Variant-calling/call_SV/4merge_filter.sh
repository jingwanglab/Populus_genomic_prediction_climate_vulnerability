#!/bin/sh
###merge 190 samples with the option  -m 50 -c -b 50 -r 0.800000012 -n 1000000 
delly merge /usr_storage/other/sci_training/lts/*/delly/*.bcf -m 50 -c -b 50 -r 0.800000012 -n 1000000 -o /usr_storage/other/sci_training/lts/delly/190samples_merge.bcf
##genotype all samples
delly call -g /pub_storage1/data/ref/pad_ref/ZSP1910a-L.LG.fasta -v /usr_storage/other/sci_training/lts/delly/190samples_merge.bcf -o /usr_storage/other/sci_training/lts/delly/genotype/ptra/Pte01.geno.bcf /usr_storage/other/sci_training/lts/pte/picard/Pte01.sort.dedup.bam
###merge
bcftools merge -m id -O b -o 190samples.merge.geno.bcf *.geno.bcf
##556827 SV events DEL 155573 DUP 29785 INV 8696 BND 359142


###filter
##step1 rename the samples SRR2744682	SwAsp001
bcftools reheader -s /usr_storage/other/sci_training/lts/delly/reheader.txt /usr_storage/other/sci_training/lts/delly/genotype/ptra/Ptra.merge.geno.bcf -o /usr_storage/other/sci_training/lts/delly/genotype/ptra/Ptra.merge.geno.rename.bcf
rm Ptra.merge.geno.bcf
### change bcf to vcf
bcftools index Ptra.merge.geno.rename.bcf
bcftools view Ptra.merge.geno.rename.bcf> Ptra.merge.geno.rename.vcf
rm Ptra.merge.geno.rename.bcf*
##minGQ>20
vcftools --vcf /usr_storage/other/sci_training/lts/delly/genotype/ptra/Ptra.merge.geno.rename.vcf --minGQ 20 --recode --recode-INFO-all --out /usr_storage/other/sci_training/lts/delly/genotype/ptra/Ptra.merge.geno.rename.GQ20

###After filtering, kept 556827 out of a possible 556827 Sites


####max missing 0.8 maf 0.0000001
vcftools --vcf /usr_storage/other/sci_training/lts/delly/genotype/ptra/Ptra.merge.geno.rename.GQ20.recode.vcf --max-missing 0.8 --maf 0.0000001 --recode --recode-INFO-all --out /usr_storage/other/sci_training/lts/delly/genotype/ptra/Ptra.merge.geno.rename.GQ20.80missing.maf10

##After filtering, kept 67213 out of a possible 556827 Sites

