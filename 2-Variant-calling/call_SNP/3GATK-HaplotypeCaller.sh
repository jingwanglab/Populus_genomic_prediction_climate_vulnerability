#!/bin/bash
set -e
INDIR="/w/00/g/g00/sangyupeng/xiangyang/picard"
OUTDIR="/w/00/g/g00/sangyupeng/xiangyang/GATK_gvcf"
juqun_file="/w/00/u/user201/juqun.txt"
JAVA="/data/apps/jdk/jdk1.8.0_131/bin/java"
reference="/w/00/g/g00/sangyupeng/xiangyang/reference/zsp193a-LH.LG.fasta"
GATK="/data/apps/gatk/gatk-4.0.5.1"

#create outdir
cd $OUTDIR
while read line
do
        if [ ! -d $line ];then
        mkdir $line
        fi
done < $juqun_file

#create g.vcf
for indir in $INDIR/*
do
	for file in `find  $indir -name "*sort.rmdup.bam"`
	do
		outdir=${indir##*/}
		infile=$file
		temp=${infile##*/}
		outfile_gvcf=${temp%sort*}g.vcf.gz
		echo "source ~/.bashrc;cd $OUTDIR/$outdir;/data/apps/jdk/jdk1.8.0_131/bin/java -Xmx16g -jar /data/apps/gatk/gatk-4.0.5.1/gatk-package-4.0.5.1-local.jar HaplotypeCaller --native-pair-hmm-threads 6 -R $reference -I $infile -O $outfile_gvcf -ERC GVCF --heterozygosity 0.01" >>  /w/00/u/user201/gatk.sh
	done
done
