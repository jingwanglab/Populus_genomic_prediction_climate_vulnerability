#!/bin/bash
set -e
indir="/w/00/g/g00/sangyupeng/xiangyang/bwa_mem/"
outdir="/w/00/g/g00/sangyupeng/xiangyang/coverage"
SAMTOOLS="/data/apps/samtools/1.9/bin"
for dir in $indir/*
do
	for file in $dir/*.bam
	do
		temp=${file##*/}
		sample=${temp%%.*}
		echo "$SAMTOOLS/samtools depth $file | awk '{if (\$3>0)sites+=1} END {print \"$sample\",sites/401417285}'> $outdir/$sample.coverage.txt"  >> /w/00/u/user201/coverage.sh	
	done
done
