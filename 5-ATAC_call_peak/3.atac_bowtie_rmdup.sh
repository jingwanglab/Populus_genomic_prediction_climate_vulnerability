#!/usr/bin/bash
set -e
DATA="/usr_storage/zxx/xy/ATAC/data"
INDIR="/usr_storage/zxx/xy/ATAC"
SAMTOOLS="/usr_storage/software/samtools-1.11/bin/samtools"
PICARD="/usr_storage/zxx/.conda/envs/picard/bin"
BOWTIE="/usr_storage/zxx/.conda/envs/bowtie2/bin"
for j in 1 2;
do
	echo "cd $INDIR;$PICARD/picard CollectInsertSizeMetrics I=${i}.q30.bam O=${i}.q30.insersize.txt H=${i}.q30.insersize.pdf M=0.5$BOWTIE/bowtie2 -N 1 -p 4 -q -X 2000 --very-sensitive -x xy -1 $DATA/${i}.R1.clean.fq.gz -2 $DATA/${i}.R2.clean.fq.gz 2>${i}.map.log | $SAMTOOLS sort -O BAM -o ${i}.bam&&$SAMTOOLS view -F 4 -u  -b -f 2 -q 30 -o ${i}.q30.bam ${i}.bam&&$PICARD/picard MarkDuplicates PG=null VERBOSITY=ERROR QUIET=true CREATE_INDEX=false INPUT=${i}.q30.bam OUTPUT=${i}.rmdup.bam M=${i}.rmdup.log&&$SAMTOOLS sort --threads 4 -o ${i}.final.sort.bam ${i}.rmdup.bam&&$SAMTOOLS index ${i}.final.sort.bam" >> map_rmdup.sh
done

