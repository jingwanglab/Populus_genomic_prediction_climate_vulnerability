.libPaths("F:/360MoveData/Users/dell/Documents/R")
rm(list=ls())
library(ggplot2)
library(dplyr)
library(tidyr)
library(gridExtra)
setwd("F:/360MoveData/Users/Desktop/NC/future/RONA/RONA_ave")
RONA_weighted_dir="F:/360MoveData/Users/Desktop/NC/future/RONA/RONA_ave/RONA_weighted"
RONA_SE_dir="F:/360MoveData/Users/Desktop/NC/future/RONA/RONA_ave/RONA_SE"
outdir="F:/360MoveData/Users/Desktop/NC/future/RONA/RONA_ave/picture"
PK=read.csv("pk.csv",head=T)
model_list=c("BJ","wc2.1_2.5m_bioc_ACCESS-CM2","wc2.1_2.5m_bioc_CanESM5","wc2.1_2.5m_bioc_GISS-E2-1-G")
SSP_list=c("ssp126","ssp245","ssp370","ssp585")
data_pk=list()
for (i in 1:19){
  ###create list to load data of 19 BIOs
  data_pk[[i]]=PK
  for (model in model_list){
    SSP_data=list()
    for (data_type in c("RONA_weighted","RONA_SE")){
      for (j in 1:4){
        data2080=read.csv(paste(data_type,"/",model,"/",model,"_",SSP_list[j],"_2061-2080NC_",data_type,".csv",sep=""),head=T) 
        data2100=read.csv(paste(data_type,"/",model,"/",model,"_",SSP_list[j],"_2081-2100NC_",data_type,".csv",sep=""),head=T)
        BIO_2080=data2080[i+1]
        BIO_2100=data2100[i+1]
        col_name=paste(model,data_type,sep="_")
        colnames(BIO_2080)=colnames(BIO_2100)=col_name
        SSP_data[[j]]=rbind(BIO_2080,BIO_2100)
      }
      data_pk[[i]][col_name]=rbind(SSP_data[[1]],SSP_data[[2]],SSP_data[[3]],SSP_data[[4]])
    }
  }
}
### calculate average RONA of 4 models
for (i in 1:19){
  data_pk[[i]]$ave_RONA=apply(data_pk[[i]][,c(5,7,9,11)],1,mean)
  data_pk[[i]]$ave_SE=apply(data_pk[[i]][,c(6,8,10,12)],1,mean)
}

plotcolors=c("#31C0C4","#F8766D")

############## SSP126&370 #################
#### BIO5 
plotdata=data_pk[[5]]
plotdata=plotdata[,-c(5:12)]
plotdata=subset(plotdata,SSP=="ssp_126" | SSP=="ssp_370")

p1=ggplot(plotdata)+
  geom_point(aes(x=reorder(POP,POP_order),y=ave_RONA,fill=factor(SSP)),color="black",shape=21,alpha=0.7,size=1.5,stat="identity")+
  geom_errorbar(aes(x=reorder(POP,POP_order),ymin=ave_RONA-ave_SE,ymax=ave_RONA+ave_SE,color=factor(SSP)),size=0.4,width=0.8,stat="identity")+
  scale_fill_manual(values=plotcolors)+
  scale_color_manual(values=plotcolors)+
  ylab(label = "BIO5_RONA (mean ± SE)")+
  xlab(label = "Population")+
  theme_bw()+
  theme(
    text=element_text(family="serif"),
    axis.text.x=element_text(angle=45,hjust=1,size=7,family="serif",color="black"),
    axis.text.y=element_text(size=9,family="serif",color="black"), 
    plot.title = element_text(
      size = 15L,
      hjust = 0.5
    ),
    axis.ticks=element_line(
      colour="black",
      size=.1,
      linetype=1,
      lineend=.1),
    axis.title.y = element_text(size = 11,family="serif",color="black"),
    axis.title.x = element_text(size = 11,family="serif",color="black"),
    legend.position="none",
    panel.background=element_rect(fill="white"),
    plot.background = element_rect(fill = "white"),
    panel.grid.major =element_blank(), 
    panel.grid.minor = element_blank(),
    plot.margin=unit(c(1,1,1,1),"mm"))+
  facet_wrap(vars(year), ncol = 2L, nrow = 1)
ggsave(p1,file="BIO5_BIO13/BIO5_SSP13.png",width=7,height=3.7)

#### BIO13 
plotdata=data_pk[[13]]
plotdata=plotdata[,-c(5:12)]
plotdata=subset(plotdata,SSP=="ssp_126" | SSP=="ssp_370")
write.csv(plotdata,file="BIO5_BIO13/test.csv",quote=F)
p2=ggplot(plotdata)+
  geom_point(aes(x=reorder(POP,POP_order),y=ave_RONA,fill=factor(SSP)),color="black",shape=21,alpha=0.7,size=1.5,stat="identity")+
  geom_errorbar(aes(x=reorder(POP,POP_order),ymin=ave_RONA-ave_SE,ymax=ave_RONA+ave_SE,color=factor(SSP)),size=0.4,width=0.8,stat="identity")+
  scale_fill_manual(values=plotcolors)+
  scale_color_manual(values=plotcolors)+
  ylab(label = "BIO13_RONA (mean ± SE)")+
  xlab(label = "Population")+
  theme_bw()+
  theme(
    text=element_text(family="serif"),
    axis.text.x=element_text(angle=45,hjust=1,size=7,family="serif",color="black"),
    axis.text.y=element_text(size=9,family="serif",color="black"), 
    plot.title = element_text(
      size = 15L,
      hjust = 0.5
    ),
    axis.ticks=element_line(
      colour="black",
      size=.1,
      linetype=1,
      lineend=.1),
    axis.title.y = element_text(size = 11,family="serif",color="black"),
    axis.title.x = element_text(size = 11,family="serif",color="black"),
    legend.position="none",
    panel.background=element_rect(fill="white"),
    plot.background = element_rect(fill = "white"),
    panel.grid.major =element_blank(), 
    panel.grid.minor = element_blank(),
    plot.margin=unit(c(1,1,1,1),"mm"))+
  facet_wrap(vars(year), ncol = 2L, nrow = 1)
ggsave(p2,file="BIO5_BIO13/BIO13_SSP13.png",width=7,height=3.7)
all=grid.arrange(p1,p2,ncol=1)
ggsave(all,file="BIO5_BIO13/BIO5_13_SSP13.png",width=7,height=7.4)


############## SSP245&585 #################
plotcolors=c("#2b6db5","#f16b88")
#### BIO5 
plotdata=data_pk[[5]]
plotdata=plotdata[,-c(5:12)]
plotdata=subset(plotdata,SSP=="ssp_245" | SSP=="ssp_585")

p1=ggplot(plotdata)+
  geom_point(aes(x=reorder(POP,POP_order),y=ave_RONA,fill=factor(SSP)),color="black",shape=21,alpha=0.7,size=1.5,stat="identity")+
  geom_errorbar(aes(x=reorder(POP,POP_order),ymin=ave_RONA-ave_SE,ymax=ave_RONA+ave_SE,color=factor(SSP)),size=0.4,width=0.8,stat="identity")+
  scale_fill_manual(values=plotcolors)+
  scale_color_manual(values=plotcolors)+
  ylab(label = "BIO5_RONA (mean ± SE)")+
  xlab(label = "Population")+
  theme_bw()+
  theme(
    text=element_text(family="serif"),
    axis.text.x=element_text(angle=45,hjust=1,size=7,family="serif",color="black"),
    axis.text.y=element_text(size=9,family="serif",color="black"), 
    plot.title = element_text(
      size = 15L,
      hjust = 0.5
    ),
    axis.ticks=element_line(
      colour="black",
      size=.1,
      linetype=1,
      lineend=.1),
    axis.title.y = element_text(size = 11,family="serif",color="black"),
    axis.title.x = element_text(size = 11,family="serif",color="black"),
    legend.position="none",
    panel.background=element_rect(fill="white"),
    plot.background = element_rect(fill = "white"),
    panel.grid.major =element_blank(), 
    panel.grid.minor = element_blank(),
    plot.margin=unit(c(1,1,1,1),"mm"))+
  facet_wrap(vars(year), ncol = 2L, nrow = 1)
ggsave(p1,file="BIO5_BIO13/BIO5_SSP24.png",width=7,height=3.7)

#### BIO13 
plotdata=data_pk[[13]]
plotdata=plotdata[,-c(5:12)]
plotdata=subset(plotdata,SSP=="ssp_245" | SSP=="ssp_585")

p2=ggplot(plotdata)+
  geom_point(aes(x=reorder(POP,POP_order),y=ave_RONA,fill=factor(SSP)),color="black",shape=21,alpha=0.7,size=1.5,stat="identity")+
  geom_errorbar(aes(x=reorder(POP,POP_order),ymin=ave_RONA-ave_SE,ymax=ave_RONA+ave_SE,color=factor(SSP)),size=0.4,width=0.8,stat="identity")+
  scale_fill_manual(values=plotcolors)+
  scale_color_manual(values=plotcolors)+
  ylab(label = "BIO13_RONA (mean ± SE)")+
  xlab(label = "Population")+
  theme_bw()+
  theme(
    text=element_text(family="serif"),
    axis.text.x=element_text(angle=45,hjust=1,size=7,family="serif",color="black"),
    axis.text.y=element_text(size=9,family="serif",color="black"), 
    plot.title = element_text(
      size = 15L,
      hjust = 0.5
    ),
    axis.ticks=element_line(
      colour="black",
      size=.1,
      linetype=1,
      lineend=.1),
    axis.title.y = element_text(size = 11,family="serif",color="black"),
    axis.title.x = element_text(size = 11,family="serif",color="black"),
    legend.position="none",
    panel.background=element_rect(fill="white"),
    plot.background = element_rect(fill = "white"),
    panel.grid.major =element_blank(), 
    panel.grid.minor = element_blank(),
    plot.margin=unit(c(1,1,1,1),"mm"))+
  facet_wrap(vars(year), ncol = 2L, nrow = 1)
ggsave(p2,file="BIO5_BIO13/BIO13_SSP24.png",width=7,height=3.7)
all=grid.arrange(p1,p2,ncol=1)
ggsave(all,file="BIO5_BIO13/BIO5_13_SSP24.png",width=7,height=7.4)
