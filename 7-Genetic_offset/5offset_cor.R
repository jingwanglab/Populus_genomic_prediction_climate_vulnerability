.libPaths("F:/360MoveData/Users/dell/Documents/R")
rm(list=ls())
library(ggplot2)
library(dplyr)
library(tidyr)
library(corrplot)
library(psych) 
setwd("F:/360MoveData/Users/Desktop/NC/future/GF/GF_2Y2S4M_cor")
BIO_19_dir="F:/360MoveData/Users/Desktop/NC/future/GF/offset/19BIOS"
BIO_6_dir="F:/360MoveData/Users/Desktop/NC/future/GF/offset/6BIOS"
model_list=c("BJ","wc2.1_2.5m_bioc_ACCESS-CM2","wc2.1_2.5m_bioc_CanESM5","wc2.1_2.5m_bioc_GISS-E2-1-G")
SSP_list=c("SSP126","SSP245","SSP370","SSP585")
coord=read.csv("coord6w.csv",head=T)
### manage the GF 19BIOS ### 
data_GF19=coord
ssp_list=c("ssp245","ssp585")
year_list=c("2080","2100")
for (model in model_list){
  ###create list to load data of 19 BIOs
  for (year in year_list){
      for (ssp in ssp_list) {
      data_year_ssp=read.csv(paste(BIO_19_dir,"/",model,"/",model,"_",ssp,"_",year,"NC_GF_offset.csv",sep=""),head=T) 
      colname=paste(model,ssp,year,sep="_")  
      data_GF19[colname]=data_year_ssp[4]
    }
  }
}
colnames(data_GF19)=c("lon","lat","BJ_ssp245_2061-2080","BJ_ssp585_2061-2080",
                      "BJ_ssp245_2081-2100","BJ_ssp585_2081-2100","ACC_ssp245_2061-2080",
                      "ACC_ssp585_2061-2080","ACC_ssp245_2081-2100","ACC_ssp585_2081-2100",
                      "Can_ssp245_2061-2080","Can_ssp585_2061-2080","Can_ssp245_2081-2100",
                      "Can_ssp585_2081-2100","GIS_ssp245_2061-2080","GIS_ssp585_2061-2080",
                      "GIS_ssp245_2081-2100","GIS_ssp585_2081-2100")
write.csv(data_GF19,file = "GF19bios.csv",quote=F,row.names = F)
#### draw-corplot
plotdata=data_GF19[,-c(1:2)]
col3 <- colorRampPalette(c( "#008D86","#3E8D89","white","#FFC8CB","#FF7279")) 
corrmatrix = cor(plotdata, method = "spearman")
rownames(corrmatrix) = as.character(names(plotdata))
colnames(corrmatrix) = as.character(names(plotdata))
res1 <-cor.mtest(corrmatrix, conf.level= .95)
corrplot.mixed(corr=corrmatrix,lower="number",upper="circle",diag="u",upper.col =col3(20),
               lower.col = col3(20),number.cex=0.58,sig.level= 0.05,
               bg = "white",
               is.corr = TRUE, outline = FALSE, mar = c(0,0,0,0),
               addCoef.col = NULL, addCoefasPercent = FALSE, 
               order = c("original"),
               rect.col = "black", rect.lwd = 1, tl.cex = 0.52,
               tl.col = "black", tl.offset = 0.4, tl.srt = 90,
               cl.cex = 0.8, cl.ratio = 0.2,tl.pos="lt",
               cl.offset = 0.5 )

#### draw-pairs.panels
pdf("panel_19bios.pdf",width=12,height=12)
pairs.panels(plotdata, scale=T)
dev.off()


### manage the GF 6BIOS ### 
data_GF6=coord
ssp_list=c("ssp245","ssp585")
year_list=c("2080","2100")
for (model in model_list){
  ###create list to load data of 6 BIOs
  for (year in year_list){
    for (ssp in ssp_list) {
      data_year_ssp=read.csv(paste(BIO_6_dir,"/",model,"/",model,"_",ssp,"_",year,"NC_GF_offset.csv",sep=""),head=T) 
      colname=paste(model,ssp,year,sep="_")  
      data_GF6[colname]=data_year_ssp[4]
    }
  }
}
colnames(data_GF6)=c("lon","lat","BJ_ssp245_2061-2080","BJ_ssp585_2061-2080",
                      "BJ_ssp245_2081-2100","BJ_ssp585_2081-2100","ACC_ssp245_2061-2080",
                      "ACC_ssp585_2061-2080","ACC_ssp245_2081-2100","ACC_ssp585_2081-2100",
                      "Can_ssp245_2061-2080","Can_ssp585_2061-2080","Can_ssp245_2081-2100",
                      "Can_ssp585_2081-2100","GIS_ssp245_2061-2080","GIS_ssp585_2061-2080",
                      "GIS_ssp245_2081-2100","GIS_ssp585_2081-2100")
write.csv(data_GF6,file = "GF6bios.csv",quote=F,row.names = F)
#### draw-corplot
plotdata=data_GF6[,-c(1:2)]
col3 <- colorRampPalette(c( "#008D86","#3E8D89","white","#FFC8CB","#FF7279")) 
corrmatrix = cor(plotdata, method = "spearman")
rownames(corrmatrix) = as.character(names(plotdata))
colnames(corrmatrix) = as.character(names(plotdata))
res1 <-cor.mtest(corrmatrix, conf.level= .95)
corrplot.mixed(corr=corrmatrix,lower="number",upper="circle",diag="u",upper.col =col3(20),
               lower.col = col3(20),number.cex=0.58,sig.level= 0.05,
               bg = "white",
               is.corr = TRUE, outline = FALSE, mar = c(0,0,0,0),
               addCoef.col = NULL, addCoefasPercent = FALSE, 
               order = c("original"),
               rect.col = "black", rect.lwd = 1, tl.cex = 0.52,
               tl.col = "black", tl.offset = 0.4, tl.srt = 90,
               cl.cex = 0.8, cl.ratio = 0.2,tl.pos="lt",
               cl.offset = 0.5 )

#### draw-pairs.panels
pdf("panel_6bios.pdf",width=12,height=12)
pairs.panels(plotdata, scale=T)
dev.off()