#!/bin/bash
set -e
INDIR="/usr_storage/syp/data3/phasing/newvcf"
outdirIHS="/usr_storage/syp/data3/phasing/newvcf/IHS"
outdirNSL="/usr_storage/syp/data3/phasing/newvcf/NSL"
shfile="/home/syp/data3_select.sh"
shdir="/home/syp/data3_select"
sh_outdir="/home/syp/data3_select_out"
mapdir="/usr_storage/syp/data3/phasing/map"
vcfdir="/usr_storage/syp/data3/phasing/newvcf"
for i in {1..19}
do
	indir="chr$i"
	infile="pkdata3_chr$i".phase.newID.vcf.gz
	mapfile="pkdata3_chr$i".phase.map
	outfile_IHS="pkdata3_chr$i".ihs
	outfile_NSL="pkdata3_chr$i".nsl
	shfile_IHS="pkdata3_chr$i".ihs.sh
	shfile_NSL="pkdata3_chr$i".nsl.sh
	shout_IHS="pkdata3_chr$i".ihs.out
	shout_NSL="pkdata3_chr$i".nsl.out
	echo "selscan --ihs --vcf $vcfdir/$infile --map $mapdir/$mapfile --pmap --maf 0.1 --out $outdirIHS/$outfile_IHS --cutoff 0.05 --alt --trunc-ok --threads 3" > $shdir/$shfile_IHS
	echo "selscan --nsl --vcf $vcfdir/$infile --map $mapdir/$mapfile --pmap --maf 0.1 --out $outdirNSL/$outfile_NSL --cutoff 0.05 --trunc-ok --alt --threads 3" > $shdir/$shfile_NSL
	echo "nohup sh $shdir/$shfile_IHS > $sh_outdir/$shout_IHS 2>&1 &" >> $shfile
	echo "nohup sh $shdir/$shfile_NSL > $sh_outdir/$shout_NSL 2>&1 &" >> $shfile
done


#### then norm the results of ihs,and calculate the abs of ihs

norm --ihs --files pkdata3_chr1.ihs.ihs.alt.out pkdata3_chr2.ihs.ihs.alt.out pkdata3_chr3.ihs.ihs.alt.out pkdata3_chr4.ihs.ihs.alt.out pkdata3_chr5.ihs.ihs.alt.out pkdata3_chr6.ihs.ihs.alt.out pkdata3_chr7.ihs.ihs.alt.out pkdata3_chr8.ihs.ihs.alt.out pkdata3_chr9.ihs.ihs.alt.out pkdata3_chr10.ihs.ihs.alt.out pkdata3_chr11.ihs.ihs.alt.out pkdata3_chr12.ihs.ihs.alt.out pkdata3_chr13.ihs.ihs.alt.out pkdata3_chr14.ihs.ihs.alt.out pkdata3_chr15.ihs.ihs.alt.out pkdata3_chr16.ihs.ihs.alt.out pkdata3_chr17.ihs.ihs.alt.out pkdata3_chr18.ihs.ihs.alt.out pkdata3_chr19.ihs.ihs.alt.out --bins 200