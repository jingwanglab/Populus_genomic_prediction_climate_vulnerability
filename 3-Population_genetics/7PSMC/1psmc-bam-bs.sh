#!/bin/bash
for dir in /w/00/g/g00/lq/psmc_test/test-command/*
do
        if [ -d $dir ];then
                cd $dir
                for i in `ls`;do
                        if [[ $i =~ ".rmdup.bam"$ ]];then
                                mkdir ${i%%.*}.bs
                                echo "/data/apps/bcftools/1.11/bin/bcftools mpileup -C50 -f /w/00/g/g00/lq/psmc_test/Populus_wilsonii/ZSP1912-L.LG.fasta $dir/$i | /data/apps/bcftools/1.11/bin/bcftools call -c | /data/apps/bcftools/1.11/bin/vcfutils.pl vcf2fq -d 10 -D 100 | gzip > $dir/${i%%.*}.fq.gz && /w/00/g/g00/share_software/psmc-master/utils/fq2psmcfa -q 20 $dir/${i%%.*}.fq.gz > $dir/${i%%.*}.psmcfa && /w/00/g/g00/share_software/psmc-master/psmc -N25 -t15 -r5 -p \"4+25*2+4+6\" -o $dir/${i%%.*}.psmc $dir/${i%%.*}.psmcfa && /w/00/g/g00/share_software/psmc-master/utils/splitfa $dir/${i%%.*}.psmcfa > $dir/${i%%.*}.split.psmcfa && seq 100 | xargs -i echo /w/00/g/g00/share_software/psmc-master/psmc -N25 -t15 -r5 -b -p \"4+25*2+4+6\" \ -o $dir/${i%%.*}.bs/round-{}.psmc $dir/${i%%.*}.split.psmcfa | sh && cat $dir/${i%%.*}.psmc $dir/${i%%.*}.bs/round-*.psmc > $dir/${i%%.*}.bs/${i%%.*}-combined-bs.psmc"
                        else
                                continue
                        fi
                done
        fi
done
