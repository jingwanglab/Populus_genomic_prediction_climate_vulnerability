#!/bin/bash
set -e
inputdir="/usr_storage/syp/pixy"
OUTDIR_pi="/usr_storage/syp/pixy/pi"
OUTDIR_pizarr="/usr_storage/syp/pixy/pi/zarr"
OUTDIR_dxy="/usr_storage/syp/pixy/dxy"
OUTDIR_dxyzarr="/usr_storage/syp/pixy/dxy/zarr"
shfile="/home/syp/pk_pidxy.sh"
sh_dir="/home/syp/pidxy_sh"
out_dir="/home/syp/pidxy_out"
pop_file="/usr_storage/syp/pk_pop/all/Pk_SN.txt"

if [ -f $shfile ];then
	rm $shfile
fi

#create pi_outdir
for vcf in $inputdir/*.gz
do
	temp1=${vcf#*.}
	chr=${temp1%%.*}
	out_pi=${temp1%%.*}_pi
        out_dxy=${temp1%%.*}_dxy
	sh1=${temp1%%.*}_pi.sh
	sh2=${temp1%%.*}_dxy.sh
	echo "pixy --stats pi --vcf $vcf --window_size 100000 --populations $pop_file --bypass_invariant_check yes --output_folder $OUTDIR_pi --output_prefix $out_pi" > $sh_dir/$sh1
	echo "pixy --stats dxy --vcf $vcf --window_size 100000 --populations $pop_file --bypass_invariant_check yes --output_folder $OUTDIR_dxy --output_prefix $out_dxy" > $sh_dir/$sh2
done

for file in $sh_dir/*
do
	out=`basename $file .sh`.out
	echo "nohup sh $file > $out_dir/$out 2>&1 &" >> $shfile
done

